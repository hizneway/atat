- debug:
    msg: "{{ vars_vals   | to_nice_json }}"

- name: get var values
  debug:
    msg: "{{ vars_vals }}"

- name: store deployment config and outputs values in {{ keyvault_name }}
  vars:
  azure_rm_keyvaultsecret:
    client_id: "{{ vault_client_id }}"
    tenant: "{{ vault_tenant }}"
    secret: "{{ vault_secret }}"
    subscription_id: "{{ vault_subscription_id }}"
    secret_name: "tf-{{ deploy_tag | regex_replace('\\.','-') }}"
    secret_value: "{{ vars_vals }}"
    tags:
      atat_deploy_version: "{{ deploy_tag }}"
    keyvault_uri: "{{ vault_url }}"
